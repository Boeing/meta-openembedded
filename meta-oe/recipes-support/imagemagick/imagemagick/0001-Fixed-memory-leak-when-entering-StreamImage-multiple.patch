From 8afe85d586b15b3b09c5c3c86a6d62b53ab8899e Mon Sep 17 00:00:00 2001
From: Dirk Lemstra <dirk@lemstra.org>
Date: Fri, 27 Jun 2025 14:51:57 +0200
Subject: [PATCH] Fixed memory leak when entering StreamImage multiple times.

CVE: CVE-2025-53019
Upstream-Status: Backport [https://github.com/ImageMagick/ImageMagick/commit/fc3ab0812edef903bbb2473c0ee652ddfd04fe5c]
Signed-off-by: Gyorgy Sarvari <skandigraun@gmail.com>
---
 MagickCore/stream.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/MagickCore/stream.c b/MagickCore/stream.c
index 786dabb52..22a0c9eee 100644
--- a/MagickCore/stream.c
+++ b/MagickCore/stream.c
@@ -1321,7 +1321,8 @@ MagickExport Image *StreamImage(const ImageInfo *image_info,
       image_info->filename);
   read_info=CloneImageInfo(image_info);
   stream_info->image_info=image_info;
-  stream_info->quantum_info=AcquireQuantumInfo(image_info,(Image *) NULL);
+  if (stream_info->quantum_info == (QuantumInfo *) NULL)
+    stream_info->quantum_info=AcquireQuantumInfo(image_info,(Image *) NULL);
   if (stream_info->quantum_info == (QuantumInfo *) NULL)
     {
       read_info=DestroyImageInfo(read_info);
