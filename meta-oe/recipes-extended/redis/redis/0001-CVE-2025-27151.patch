From 96f00cb60cb6e73c66375264227872053385bea2 Mon Sep 17 00:00:00 2001
From: Gyorgy Sarvari <skandigraun@gmail.com>
Date: Tue, 7 Oct 2025 21:26:55 +0200
Subject: [PATCH] CVE-2025-27151

Ensure that the length of the input file name does not exceed PATH_MAX

CVE: CVE-2025-27151
Upstream-Status: Backport [https://github.com/redis/redis/commit/d0eeee6e31f0fefb510007a8cfdf5dce729a8be9]

Signed-off-by: Gyorgy Sarvari <skandigraun@gmail.com>
---
 src/redis-check-aof.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/redis-check-aof.c b/src/redis-check-aof.c
index 1507e0a..f7dd5cb 100644
--- a/src/redis-check-aof.c
+++ b/src/redis-check-aof.c
@@ -164,6 +164,11 @@ int redis_check_aof_main(int argc, char **argv) {
         exit(1);
     }
 
+    if (strlen(filename) > PATH_MAX) {
+        printf("Error: filename is too long (exceeds PATH_MAX)\n");
+        exit(1);
+    }
+
     FILE *fp = fopen(filename,"r+");
     if (fp == NULL) {
         printf("Cannot open file: %s\n", filename);
